(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[674],{4421:function(e,a,s){Promise.resolve().then(s.bind(s,9913))},9913:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return G}});var t=s(7437),r=s(605),l=s(9376),n=s(2265),d=s(3723),i=s(2869),o=s(5186),c=s(6815),u=s(6070),m=s(4508);let f=n.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("div",{className:"relative w-full overflow-auto",children:(0,t.jsx)("table",{ref:a,className:(0,m.cn)("w-full caption-bottom text-sm",s),...r})})});f.displayName="Table";let x=n.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("thead",{ref:a,className:(0,m.cn)("[&_tr]:border-b",s),...r})});x.displayName="TableHeader";let h=n.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("tbody",{ref:a,className:(0,m.cn)("[&_tr:last-child]:border-0",s),...r})});h.displayName="TableBody",n.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("tfoot",{ref:a,className:(0,m.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...r})}).displayName="TableFooter";let p=n.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("tr",{ref:a,className:(0,m.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...r})});p.displayName="TableRow";let j=n.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("th",{ref:a,className:(0,m.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",s),...r})});j.displayName="TableHead";let g=n.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("td",{ref:a,className:(0,m.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",s),...r})});g.displayName="TableCell",n.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("caption",{ref:a,className:(0,m.cn)("mt-4 text-sm text-muted-foreground",s),...r})}).displayName="TableCaption";let b=(0,s(535).j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function v(e){let{className:a,variant:s,...r}=e;return(0,t.jsx)("div",{className:(0,m.cn)(b({variant:s}),a),...r})}var y=s(9027),N=s(2489);let w=y.fC,_=y.xz,k=y.h_;y.x8;let C=n.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(y.aV,{ref:a,className:(0,m.cn)("fixed inset-0 z-50 bg-background/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...r})});C.displayName=y.aV.displayName;let R=n.forwardRef((e,a)=>{let{className:s,children:r,...l}=e;return(0,t.jsxs)(k,{children:[(0,t.jsx)(C,{}),(0,t.jsxs)(y.VY,{ref:a,className:(0,m.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...l,children:[r,(0,t.jsxs)(y.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,t.jsx)(N.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});R.displayName=y.VY.displayName;let S=e=>{let{className:a,...s}=e;return(0,t.jsx)("div",{className:(0,m.cn)("flex flex-col space-y-1.5 text-center sm:text-left",a),...s})};S.displayName="DialogHeader";let Z=e=>{let{className:a,...s}=e;return(0,t.jsx)("div",{className:(0,m.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...s})};Z.displayName="DialogFooter";let z=n.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(y.Dx,{ref:a,className:(0,m.cn)("text-lg font-semibold leading-none tracking-tight",s),...r})});z.displayName=y.Dx.displayName;let U=n.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(y.dk,{ref:a,className:(0,m.cn)("text-sm text-muted-foreground",s),...r})});U.displayName=y.dk.displayName;var T=s(3911),A=s(875),F=s(2135),E=s(401);let L=T.fC;T.ZA;let D=T.B4,I=n.forwardRef((e,a)=>{let{className:s,children:r,...l}=e;return(0,t.jsxs)(T.xz,{ref:a,className:(0,m.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...l,children:[r,(0,t.jsx)(T.JO,{asChild:!0,children:(0,t.jsx)(A.Z,{className:"h-4 w-4 opacity-50"})})]})});I.displayName=T.xz.displayName;let V=n.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(T.u_,{ref:a,className:(0,m.cn)("flex cursor-default items-center justify-center py-1",s),...r,children:(0,t.jsx)(F.Z,{className:"h-4 w-4"})})});V.displayName=T.u_.displayName;let O=n.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(T.$G,{ref:a,className:(0,m.cn)("flex cursor-default items-center justify-center py-1",s),...r,children:(0,t.jsx)(A.Z,{className:"h-4 w-4"})})});O.displayName=T.$G.displayName;let q=n.forwardRef((e,a)=>{let{className:s,children:r,position:l="popper",...n}=e;return(0,t.jsx)(T.h_,{children:(0,t.jsxs)(T.VY,{ref:a,className:(0,m.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===l&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:l,...n,children:[(0,t.jsx)(V,{}),(0,t.jsx)(T.l_,{className:(0,m.cn)("p-1","popper"===l&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,t.jsx)(O,{})]})})});q.displayName=T.VY.displayName,n.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(T.__,{ref:a,className:(0,m.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...r})}).displayName=T.__.displayName;let Y=n.forwardRef((e,a)=>{let{className:s,children:r,...l}=e;return(0,t.jsxs)(T.ck,{ref:a,className:(0,m.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...l,children:[(0,t.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,t.jsx)(T.wU,{children:(0,t.jsx)(E.Z,{className:"h-4 w-4"})})}),(0,t.jsx)(T.eT,{children:r})]})});Y.displayName=T.ck.displayName,n.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(T.Z0,{ref:a,className:(0,m.cn)("-mx-1 my-1 h-px bg-muted",s),...r})}).displayName=T.Z0.displayName;var P=s(9397),H=s(3247),M=s(4630),X=s(8930),B=s(5613);function G(){let{data:e,status:a}=(0,r.useSession)(),s=(0,l.useRouter)(),[m,b]=(0,n.useState)([]),[y,N]=(0,n.useState)(!0),[k,C]=(0,n.useState)(""),[T,A]=(0,n.useState)(!1),[F,E]=(0,n.useState)(null),[V,O]=(0,n.useState)({username:"",email:"",password:"",first_name:"",last_name:"",role:"student"}),[G,J]=(0,n.useState)(""),[$,W]=(0,n.useState)("");(0,n.useEffect)(()=>{if("loading"!==a){if(!e||!e.user||"admin"!==e.user.role){s.push("/login");return}K()}},[e,a,s]);let K=async()=>{try{let e=await fetch("/api/admin/users");if(e.ok){let a=await e.json();b(a)}}catch(e){console.error("Failed to fetch users:",e)}finally{N(!1)}},Q=async e=>{e.preventDefault(),J(""),W("");try{let e=F?"/api/admin/users/".concat(F.id):"/api/admin/users",a=await fetch(e,{method:F?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(V)});if(a.ok)W(F?"User updated successfully":"User created successfully"),A(!1),E(null),O({username:"",email:"",password:"",first_name:"",last_name:"",role:"student"}),K();else{let e=await a.json();J(e.error||"Failed to save user")}}catch(e){J("An error occurred while saving the user")}},ee=e=>{E(e),O({username:e.username,email:e.email,password:"",first_name:e.first_name,last_name:e.last_name,role:e.role}),A(!0)},ea=async e=>{if(confirm("Are you sure you want to delete this user?"))try{(await fetch("/api/admin/users/".concat(e),{method:"DELETE"})).ok?(W("User deleted successfully"),K()):J("Failed to delete user")}catch(e){J("An error occurred while deleting the user")}},es=m.filter(e=>e.username.toLowerCase().includes(k.toLowerCase())||e.email.toLowerCase().includes(k.toLowerCase())||"".concat(e.first_name," ").concat(e.last_name).toLowerCase().includes(k.toLowerCase()));return"loading"===a||y?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900 mx-auto mb-4"}),(0,t.jsx)("p",{children:"Loading users..."})]})}):e&&e.user&&"admin"===e.user.role?(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,t.jsx)(d.W,{}),(0,t.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"User Management"}),(0,t.jsx)("p",{className:"text-gray-600 mt-2",children:"Manage system users, roles, and permissions"})]}),G&&(0,t.jsx)(B.bZ,{variant:"destructive",className:"mb-4",children:(0,t.jsx)(B.X,{children:G})}),$&&(0,t.jsx)(B.bZ,{className:"mb-4",children:(0,t.jsx)(B.X,{children:$})}),(0,t.jsxs)(u.Zb,{children:[(0,t.jsx)(u.Ol,{children:(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(u.ll,{children:"Users"}),(0,t.jsx)(u.SZ,{children:"Manage all system users and their roles"})]}),(0,t.jsxs)(w,{open:T,onOpenChange:A,children:[(0,t.jsx)(_,{asChild:!0,children:(0,t.jsxs)(i.z,{onClick:()=>{E(null),O({username:"",email:"",password:"",first_name:"",last_name:"",role:"student"})},children:[(0,t.jsx)(P.Z,{className:"h-4 w-4 mr-2"}),"Add User"]})}),(0,t.jsxs)(R,{children:[(0,t.jsxs)(S,{children:[(0,t.jsx)(z,{children:F?"Edit User":"Add New User"}),(0,t.jsx)(U,{children:F?"Update user information":"Create a new user account"})]}),(0,t.jsxs)("form",{onSubmit:Q,children:[(0,t.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(c._,{htmlFor:"first_name",children:"First Name"}),(0,t.jsx)(o.I,{id:"first_name",value:V.first_name,onChange:e=>O({...V,first_name:e.target.value}),required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(c._,{htmlFor:"last_name",children:"Last Name"}),(0,t.jsx)(o.I,{id:"last_name",value:V.last_name,onChange:e=>O({...V,last_name:e.target.value}),required:!0})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(c._,{htmlFor:"username",children:"Username"}),(0,t.jsx)(o.I,{id:"username",value:V.username,onChange:e=>O({...V,username:e.target.value}),required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(c._,{htmlFor:"email",children:"Email"}),(0,t.jsx)(o.I,{id:"email",type:"email",value:V.email,onChange:e=>O({...V,email:e.target.value}),required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)(c._,{htmlFor:"password",children:["Password ",F&&"(leave blank to keep current)"]}),(0,t.jsx)(o.I,{id:"password",type:"password",value:V.password,onChange:e=>O({...V,password:e.target.value}),required:!F})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(c._,{htmlFor:"role",children:"Role"}),(0,t.jsxs)(L,{value:V.role,onValueChange:e=>O({...V,role:e}),children:[(0,t.jsx)(I,{children:(0,t.jsx)(D,{})}),(0,t.jsxs)(q,{children:[(0,t.jsx)(Y,{value:"student",children:"Student"}),(0,t.jsx)(Y,{value:"teacher",children:"Teacher"}),(0,t.jsx)(Y,{value:"admin",children:"Admin"})]})]})]})]}),(0,t.jsx)(Z,{children:(0,t.jsx)(i.z,{type:"submit",children:F?"Update User":"Create User"})})]})]})]})]})}),(0,t.jsxs)(u.aY,{children:[(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(H.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),(0,t.jsx)(o.I,{placeholder:"Search users...",value:k,onChange:e=>C(e.target.value),className:"pl-10"})]})}),(0,t.jsxs)(f,{children:[(0,t.jsx)(x,{children:(0,t.jsxs)(p,{children:[(0,t.jsx)(j,{children:"Name"}),(0,t.jsx)(j,{children:"Username"}),(0,t.jsx)(j,{children:"Email"}),(0,t.jsx)(j,{children:"Role"}),(0,t.jsx)(j,{children:"Status"}),(0,t.jsx)(j,{children:"Created"}),(0,t.jsx)(j,{children:"Actions"})]})}),(0,t.jsx)(h,{children:es.map(e=>(0,t.jsxs)(p,{children:[(0,t.jsxs)(g,{className:"font-medium",children:[e.first_name," ",e.last_name]}),(0,t.jsx)(g,{children:e.username}),(0,t.jsx)(g,{children:e.email}),(0,t.jsx)(g,{children:(0,t.jsx)(v,{variant:"admin"===e.role?"destructive":"teacher"===e.role?"default":"secondary",children:e.role})}),(0,t.jsx)(g,{children:(0,t.jsx)(v,{variant:e.is_active?"default":"secondary",children:e.is_active?"Active":"Inactive"})}),(0,t.jsx)(g,{children:new Date(e.created_at).toLocaleDateString()}),(0,t.jsx)(g,{children:(0,t.jsxs)("div",{className:"flex space-x-2",children:[(0,t.jsx)(i.z,{variant:"outline",size:"sm",onClick:()=>ee(e),children:(0,t.jsx)(M.Z,{className:"h-4 w-4"})}),(0,t.jsx)(i.z,{variant:"outline",size:"sm",onClick:()=>ea(e.id),className:"text-red-600 hover:text-red-700",children:(0,t.jsx)(X.Z,{className:"h-4 w-4"})})]})})]},e.id))})]})]})]})]})]}):null}},5613:function(e,a,s){"use strict";s.d(a,{X:function(){return o},bZ:function(){return i}});var t=s(7437),r=s(2265),l=s(535),n=s(4508);let d=(0,l.j)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),i=r.forwardRef((e,a)=>{let{className:s,variant:r,...l}=e;return(0,t.jsx)("div",{ref:a,role:"alert",className:(0,n.cn)(d({variant:r}),s),...l})});i.displayName="Alert",r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("h5",{ref:a,className:(0,n.cn)("mb-1 font-medium leading-none tracking-tight",s),...r})}).displayName="AlertTitle";let o=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("div",{ref:a,className:(0,n.cn)("text-sm [&_p]:leading-relaxed",s),...r})});o.displayName="AlertDescription"},5186:function(e,a,s){"use strict";s.d(a,{I:function(){return n}});var t=s(7437),r=s(2265),l=s(4508);let n=r.forwardRef((e,a)=>{let{className:s,type:r,...n}=e;return(0,t.jsx)("input",{type:r,className:(0,l.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:a,...n})});n.displayName="Input"},6815:function(e,a,s){"use strict";s.d(a,{_:function(){return o}});var t=s(7437),r=s(2265),l=s(6394),n=s(535),d=s(4508);let i=(0,n.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),o=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(l.f,{ref:a,className:(0,d.cn)(i(),s),...r})});o.displayName=l.f.displayName}},function(e){e.O(0,[605,791,677,81,519,971,117,744],function(){return e(e.s=4421)}),_N_E=e.O()}]);